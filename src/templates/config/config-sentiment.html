{% extends "base.html" %}
{% load static %}

{% block page_css %}
    <link rel="stylesheet" href="{% static 'css/config.css' %}">
{% endblock %}

{% block navbar_search %}
<div class="d-flex ms-auto gap-2">
    <a href="{% url 'admin-sentence' %}" class="btn btn-outline-light" role="button">
        Sentence
    </a>
    <a href="{% url 'admin-sentiment' %}" class="btn btn-outline-light" role="button">
        Sentiment
    </a>
</div>
{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">Admin Tools</h1>
            <p class="page-subtitle">Sentiment Management</p>
        </div>

        <div class="row g-4 mb-5">
            <div class="col-lg-4 col-md-6">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h5 class="admin-card-title">Export Sentiments</h5>
                        <span class="badge bg-secondary">.json</span>
                    </div>
                    <div class="admin-card-body">
                        <p class="admin-card-text">Download all existing sentiments as a JSON file.</p>
                        <form method="post" action="{% url 'admin-sentiment' %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="export_sentiments">
                            <button type="submit" class="btn btn-primary w-100">
                                Export Sentiments
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h5 class="admin-card-title">Delete All Sentiments</h5>
                    </div>
                    <div class="admin-card-body">
                        <p class="admin-card-text">Deletes all existing sentiments and past queries. This action cannot be undone.</p>
                        <form method="post" action="{% url 'admin-sentiment' %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="delete_all_sentiments">
                            <button type="submit" 
                                    class="btn btn-danger w-100"
                                    data-confirm="Are you absolutely sure you want to delete ALL sentiment instances? This will also remove all your queries, and it cannot be undone.">
                                Delete All Sentiments
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        {% for query_entry in all_sentiments %}
            {% if query_entry.related_entries %}
            <div class="data-section">
                <div class="section-header">
                    <h2 class="section-title">Query: <span class="text-muted fw-normal">{{ query_entry.query_text }}</span></h2>
                    <form method="post" action="{% url 'admin-sentiment' %}" class="d-inline">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="delete_a_query">
                        <input type="hidden" name="query_id" value="{{ query_entry.query_id }}">
                        <button type="submit" 
                                class="btn btn-sm btn-outline-danger"
                                data-confirm="Are you sure you want to delete this query? All sentiments under this query will also be deleted. This action cannot be undone."
                                title="Delete Query">
                            Delete Query
                        </button>
                    </form>
                </div>

                <div class="table-wrapper">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Sentence</th>
                                <th style="width: 150px;">Relation</th>
                                <th style="width: 100px;" class="text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for relation in query_entry.related_entries %}
                            <tr>
                                <td class="sentence-text">{{ relation.sentence_text }}</td>
                                <td>
                                    {% if relation.relation == "agreement" %}
                                        <span class="badge bg-success">Agree</span>
                                    {% elif relation.relation == "disagreement" %}
                                        <span class="badge bg-danger">Disagree</span>
                                    {% elif relation.relation == "no_relation" %}
                                        <span class="badge bg-secondary">Neutral</span>
                                    {% endif %}
                                </td>
                                <td class="text-center">
                                    <form method="post" action="{% url 'admin-sentiment' %}" class="d-inline">
                                        {% csrf_token %}
                                        <input type="hidden" name="action" value="remove_a_sentiment">
                                        <input type="hidden" name="sentiment_id" value="{{ relation.sentiment_id }}">
                                        <button type="submit" 
                                                class="btn btn-sm btn-outline-danger"
                                                title="Delete">
                                            Delete
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
        {% endfor %}

        {% if not all_sentiments or not all_sentiments|length %}
            <div class="data-section">
                <div class="text-center text-muted py-5">
                    <p>No sentiment data available</p>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
